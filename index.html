<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>蔵王ジャンプ台クイズ</title>
<style>
body {
  margin: 0;
  padding: 0;
  background: url("suki.JPG") no-repeat center center fixed;
  background-size: cover;
  font-family: 'Yu Gothic', 'Segoe UI', sans-serif;
  color: #fff;
}
.quiz-container {
  max-width: 95%;
  width: 600px;
  margin: 30px auto;
  background: rgba(0,128,0,0.6);
  padding: 20px;
  border-radius: 15px;
  box-shadow: 0 0 10px rgba(0,0,0,0.8);
  text-align: center;
}
h1 { font-size: 1.5em; }
.options { display: grid; grid-template-columns: 1fr; gap: 12px; margin-top: 20px; }
.option-btn, .answer-btn {
  padding: 12px; border: none; border-radius: 10px;
  font-size: 1.2em; cursor: pointer; background-color: #ffecb3; color: #000; transition: background 0.3s;
}
.option-btn:hover:enabled, .answer-btn:hover { background-color: #ffd54f; }
.option-btn.correct { background-color: #4caf50 !important; color: #fff; }
.option-btn.wrong { background-color: #9e9e9e !important; color: #fff; }
.answer-input { width: 100%; padding: 10px; font-size: 1em; margin: 15px 0; border-radius: 8px; border: 1px solid #ccc; }
#hintBtn {
  margin-top: 25px; padding: 12px 20px; font-size: 1.2em; border: none;
  border-radius: 10px; cursor: pointer; background-color: #81d4fa; color: #000; transition: background 0.3s;
}
#hint {
  margin-top: 15px; padding: 10px; background-color: rgba(200,230,200,0.8);
  border-radius: 10px; font-size: 1.2em; display: none; color: #000;
}
.message, .keyword { margin-top: 15px; font-weight: bold; font-size: 1.6em; }
</style>
</head>
<body>
<div class="quiz-container" id="quiz-container">
  <h1 id="question">読み込み中...</h1>
  <div class="options" id="options"></div>
  <button id="hintBtn">ヒントを見る</button>
  <p id="hint"></p>
</div>

<!-- confetti.js の読み込み -->
<script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

<script>
const quizzes = {
  1: { question: "蔵王ジャンプ台が建設されたのはいつでしょうか?", options:["1976年","1978年","1980年","1982年"], answer:1, hint:"受付で配ったパンフレットを見よう!", keyword:"ツ" },
  2: { question: "ジャンプ台の下から上までの標高差と近い高さの建物はどれでしょうか?", options:["山形市役所","山形県庁","上山スカイタワー","霞城セントラル"], answer:3, hint:"インフォメーションコーナー横の看板を見てみよう!", keyword:"ャ" },
  3: { question: "蔵王ジャンプ台で髙梨沙羅選手が出した最大の飛距離はどれでしょう?", options:["101.0m","103.5m","106.0m","108.5m"], answer:2, hint:"ジャンプ台に設置されている看板を見てみよう!", keyword:"ェ" },
  4: { question: "選手が着地する場所(ランディングバーン)の最大斜度は何度でしょうか?", options:["35度","36.5度","38度","39.5度"], answer:1, hint:"受付で配ったパンフレットを見よう!", keyword:"シ" },
  5: { question: "8月に開催されたサマージャンプ大会で第2位となった内藤智文選手の勤務先はどちらでしょうか?", options:["蔵王温泉宿泊施設","蔵王温泉スキー場","山形県職員","山形市職員"], answer:3, hint:"受付テントに掲示してある新聞のコピーを見てみよう!", keyword:"ン" },
  final: { question: "5つのキーワードをはめ込んで答えを導きだそう!\nアリオンテック蔵王〇〇〇〇〇", answerText:"シャンツェ", hint:"キーワードを並べ替えて考えよう!" }
};

const urlParams = new URLSearchParams(window.location.search);
const q = urlParams.get("q") || 1;
const quiz = quizzes[q];

const container = document.getElementById("quiz-container");
const questionEl = document.getElementById("question");
const optionsEl = document.getElementById("options");
const hintBtn = document.getElementById("hintBtn");
const hintEl = document.getElementById("hint");

let correctKeywords = JSON.parse(localStorage.getItem("keywords")||"[]");
if(q!=="final" && !correctKeywords.includes(quiz.keyword)){ correctKeywords.push(quiz.keyword); localStorage.setItem("keywords", JSON.stringify(correctKeywords)); }

if(quiz){
  questionEl.textContent = quiz.question;

  if(q==="final"){
    const pKeywords = document.createElement("p");
    pKeywords.className = "message";
    pKeywords.textContent = "これまでのキーワード: " + correctKeywords.join("");
    container.insertBefore(pKeywords, optionsEl);

    const input = document.createElement("input");
    input.type="text"; input.className="answer-input"; input.placeholder="ここに答えを入力";
    optionsEl.appendChild(input);

    const btn = document.createElement("button");
    btn.textContent="解答する"; btn.className="answer-btn";
    btn.onclick = () => checkFinal(input.value);
    optionsEl.appendChild(btn);

  } else {
    quiz.options.forEach((opt, idx)=>{
      const btn=document.createElement("button");
      btn.textContent=opt; btn.classList.add("option-btn");
      btn.onclick = () => checkAnswer(idx, btn);
      optionsEl.appendChild(btn);
    });
  }
  hintEl.textContent = quiz.hint;
}

let locked = false;
function checkAnswer(choice, btn){
  if(locked) return;
  const allBtns = document.querySelectorAll(".option-btn");
  if(choice===quiz.answer){
    btn.classList.add("correct");
    container.innerHTML = `
      <h1 style="font-size:2em;">正解！よくできました！</h1>
      <p class="message">正解は「${quiz.options[quiz.answer]}」です。</p>
      <p class="keyword">キーワード: ${quiz.keyword}</p>
    `;
    launchConfetti();
  } else {
    locked = true;
    btn.classList.add("wrong");
    const msg = document.createElement("p"); msg.textContent="不正解！5秒後に再挑戦できます"; msg.style.fontSize="1.5em"; msg.style.color="yellow";
    container.appendChild(msg);
    allBtns.forEach(b=>b.disabled=true);
    setTimeout(()=>{
      locked=false;
      allBtns.forEach(b=>{b.disabled=false; b.classList.remove("wrong");});
      container.removeChild(msg);
    },5000);
  }
}

function checkFinal(input){
  if(input.trim()===quizzes.final.answerText){
    container.innerHTML=`
      <h1 style="font-size:2em;">おめでとう！全問クリア！</h1>
      <p class="message">答えは「${quizzes.final.answerText}」でした。</p>
      <p><a href="https://forms.gle/mfHe6rbxjTjCdYtG6" target="_blank" style="color:yellow; font-weight:bold;">▶ アンケートにご協力ください</a></p>
    `;
    localStorage.removeItem("keywords");
    launchConfetti();
  } else { alert("残念！もう一度考えてみてね。"); }
}

function launchConfetti(){
  confetti({
    particleCount: 120,
    spread: 70,
    origin: { y: 0.6 }
  });
}

hintBtn.onclick = ()=>{
  if(hintEl.style.display==="none"||hintEl.style.display===""){
    hintEl.style.display="block"; hintBtn.textContent="ヒントを閉じる";
  } else { hintEl.style.display="none"; hintBtn.textContent="ヒントを見る"; }
};
</script>
</body>
</html>

